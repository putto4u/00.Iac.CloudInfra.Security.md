
이 도커파일은 **Ubuntu 24.04**를 기반으로 시스템 도구 버전 고정, 보안을 위한 GPG 키 관리 구조, 
다중 파이썬 관리를 위한 **pyenv**, 그리고 인프라 관리를 위한 **Terraform**과 **AWS CLI**까지 
모두 통합된 올인원(All-in-One) 레시피입니다.

---

### 🐳 [최종본?] puttou4u 전문가용 통합 실습 환경 Dockerfile

```dockerfile
# =================================================================
# 1. 베이스 이미지 및 메타데이터 설정
# =================================================================
FROM ubuntu:24.04

LABEL org.opencontainers.image.authors="puttou4u <puttou4u@example.com>"
LABEL maintainer="puttou4u <puttou4u@example.com>"
LABEL description="Ubuntu 24.04 - Python(pyenv), Terraform, AWS CLI 통합 실습 환경"

# 2. 환경 변수 설정 (설치 프로세스 자동화 및 경로 최적화)
ENV DEBIAN_FRONTEND=noninteractive
ENV PYENV_ROOT="/root/.pyenv"
ENV PATH="$PYENV_ROOT/bin:$PYENV_ROOT/shims:$PATH"

# =================================================================
# 3. 시스템 필수 패키지 설치 (버전 고정 및 네트워크 도구 포함)
# =================================================================
RUN apt-get update && apt-get install -y \
    curl=8.5.0-2ubuntu10 \
    git=1:2.43.0-1ubuntu7.1 \
    vim=2:9.1.0-1ubuntu2 \
    unzip=6.0-28ubuntu4 \
    python3=3.12.3-0ubuntu1 \
    python3-pip=24.0+dfsg-2ubuntu1 \
    ca-certificates \
    gnupg \
    net-tools \
    iputils-ping \
    && apt-get clean && rm -rf /var/lib/apt/lists/*

# =================================================================
# 4. 보안 및 확장성을 위한 GPG 키링 설정
# =================================================================
# 주석: 외부 저장소 추가 시 보안 검증을 위한 표준 디렉토리 구조 생성
RUN install -m 0755 -d /etc/apt/keyrings && \
    curl -fsSL https://download.docker.com/linux/ubuntu/gpg | gpg --dearmor -o /etc/apt/keyrings/docker.gpg && \
    chmod a+r /etc/apt/keyrings/docker.gpg

# =================================================================
# 5. 인프라 관리 도구 설치 (Terraform & AWS CLI)
# =================================================================
# Terraform 설치 (버전 고정: 1.7.0)
RUN curl -LO https://releases.hashicorp.com/terraform/1.7.0/terraform_1.7.0_linux_amd64.zip \
    && unzip terraform_1.7.0_linux_amd64.zip \
    && mv terraform /usr/local/bin/ \
    && rm terraform_1.7.0_linux_amd64.zip

# AWS CLI 설치 (클라우드 리소스 관리 및 Terraform 인증용)
RUN curl "https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip" -o "awscliv2.zip" \
    && unzip awscliv2.zip && ./aws/install && rm -rf awscliv2.zip ./aws

# =================================================================
# 6. pyenv 설치 및 파이썬 환경 구축 (버전: 3.12.1)
# =================================================================
# 파이썬 컴파일에 필요한 의존성 라이브러리 설치
RUN apt-get update && apt-get install -y \
    make build-essential libssl-dev zlib1g-dev \
    libbz2-dev libreadline-dev libsqlite3-dev wget llvm \
    libncursesw5-dev xz-utils tk-dev libxml2-dev libxmlsec1-dev \
    libffi-dev liblzma-dev \
    && apt-get clean && rm -rf /var/lib/apt/lists/*

# pyenv 설치 및 특정 파이썬 버전 빌드 (수행 시간이 다소 소요됨)
RUN curl https://pyenv.run | bash && \
    pyenv install 3.12.1 && \
    pyenv global 3.12.1

# =================================================================
# 7. 작업 디렉토리 및 사용자 쉘 환경 설정
# =================================================================
WORKDIR /app

# 컨테이너 접속 시 pyenv가 즉시 활성화되도록 .bashrc에 등록
RUN echo 'export PYENV_ROOT="$HOME/.pyenv"' >> ~/.bashrc && \
    echo 'export PATH="$PYENV_ROOT/bin:$PATH"' >> ~/.bashrc && \
    echo 'eval "$(pyenv init -)"' >> ~/.bashrc

# 기본 실행 터미널 설정
CMD ["/bin/bash"]

```

---

### 💡 실전 활용 및 에러 방지 가이드 (강사님 필독)

1. **새 PC에서의 빌드 명령어**:
```bash
# 아이디 'puttou4u'와 버전 태그를 명시하여 빌드
docker build -t puttou4u/expert-lab:v1.0 .

```


2. **실행 시 권장 옵션 (네트워크 및 인증 공유)**:
새 PC에서 테라폼 실습 시 네트워크 에러를 방지하고 호스트의 AWS 인증 정보를 그대로 쓰려면 아래와 같이 실행하세요.
```bash
docker run -it --name my-lab \
  --net=host \
  -v ~/.aws:/root/.aws \
  puttou4u/expert-lab:v1.0

```


* `--net=host`: 컨테이너가 호스트의 IP와 네트워크를 공유하여 통신 에러를 최소화합니다.
* `-v ~/.aws:/root/.aws`: 호스트 PC에 저장된 AWS 자격 증명을 컨테이너와 공유합니다.


3. **자주 실수하는 부분**:
* `apt` 패키지 버전은 우분투 공식 저장소 업데이트에 따라 간혹 변경될 수 있습니다. 만약 빌드 시 `Version not found` 에러가 나면 해당 패키지의 버전 부분(`=버전`)만 삭제하거나 최신 번호로 갱신해 주세요.



---

**이 Dockerfile은 다른 어떤 PC로 이동하더라도 `docker build` 한 번으로 완벽한 인프라와 개발 환경을 재현해 줄 것입니다.**
